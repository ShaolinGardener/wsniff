{% extends "layout.html" %}

{% block content %}
<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="{{ url_for('static', filename='js/leaflet.min.js') }}"></script>

{% if not available %}
<div class="alert alert-danger" role="alert">
    No GPS Connection
</div>
{% else %}
<div class="alert alert-success" role="alert">
    GPS Connection Available
</div>
{% endif %}

<h2>Current Location</h2>

<div class="text-center mt-4 mb-4">
    {% if running %}
      <a class="btn btn-danger btn-lg" href="{{url_for('gps_stop')}}">Stop GPS module</a>
    {% else %}
      <a class="btn btn-success btn-lg" href="{{url_for('gps_start')}}">Start GPS module</a>
    {% endif %}
</div>

<div id="mapid" style="height: 500px;"></div>

<script type="text/javascript">
    //use parseFloat to get rid of leading zeros which result in a syntax error
    let lat = parseFloat("{{ lat }}");
    let lon = parseFloat("{{ lon }}");
    //var mymap = L.map('mapid').setView([49.77915766666667, 11.1776305], 18);
    var mymap = L.map('mapid').setView([lat, lon], 18);

    //da muss man sich registrieren / braucht access token
    // L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    //     attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    //     maxZoom: 20,
    //     id: 'mapbox/streets-v11',
    //     tileSize: 512,
    //     zoomOffset: -1,
    //     accessToken: 'pk.eyJ1IjoianVsaWFud2luZGVjayIsImEiOiJja2tmcTBxdHkwdzZ2MnFxdDJpZDExdXV1In0.abm2_5VInUX9Wb0sGPj-dA'
    // }).addTo(mymap);
    
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        'attribution':  'Kartendaten &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> Mitwirkende',
        'useCache': true,
        'maxZoom': 19, //hoechstmoeglicher wert fuer openstreetmap.org
        'zoomOffset':  0
    }).addTo(mymap);

    

    points = [[49.779666666666664,11.177148],
        [49.779666666666664,11.177148],
        [49.779666666666664,11.177148],
        [49.77967983333333,11.1771325],
        [49.77969733333333,11.177119],
        [49.7797175,11.177051833333334],
        [49.77972716666667,11.177007666666666],
        [49.779736,11.176986],
        [49.779742166666665,11.176971666666667],
        [49.77974716666667,11.1769645],
        [49.779753,11.176962166666666],
        [49.7797615,11.176964833333333],
        [49.77976433333333,11.176968333333333],
        [49.779763333333335,11.176972333333334],
        [49.77975966666666,11.176979333333334],
        [49.77975683333333,11.176987],
        [49.77975716666667,11.176995666666667],
        [49.779765833333336,11.177004166666666],
        [49.779772,11.177014166666666],
        [49.7797725,11.177024833333334],
        [49.779710666666666,11.177022666666666],
        [49.779726333333336,11.177031333333334],
        [49.77974016666667,11.177037666666667],
        [49.7797485,11.177041166666667],
        [49.7797605,11.177050333333334],
        [49.77977116666667,11.177059333333334],
        [49.779780833333334,11.177066833333333],
        [49.779785333333336,11.177072166666667],
        [49.77979633333333,11.177076],
        [49.77980616666667,11.177083666666666],
        [49.77981116666667,11.177093166666667],
        [49.77982016666667,11.177099833333333],
        [49.77982816666667,11.1771065],
        [49.779834666666666,11.1771145],
        [49.77984,11.177122333333333],
        [49.779848,11.177129333333333],
        [49.779855833333336,11.1771375],
        [49.77986583333333,11.177144333333333],
        [49.77987666666667,11.177151],
        [49.779884333333335,11.177159833333333],
        [49.77989433333333,11.177167],
        [49.7799005,11.177174166666667],
        [49.77990483333333,11.177182166666666],
        [49.77991266666667,11.177188],
        [49.779922,11.177195],
        [49.7799265,11.177203166666667],
        [49.779934,11.177211833333333],
        [49.779939666666664,11.1772215],
        [49.77994983333333,11.177226833333334],
        [49.77995766666667,11.177232833333333],
        [49.77996566666667,11.177238333333333],
        [49.77997283333333,11.177240333333334],
        [49.779978666666665,11.177243333333333],
        [49.7799865,11.177248333333333],
        [49.779995666666665,11.177254],
        [49.780005333333335,11.177259],
        [49.7800145,11.177265666666667],
        [49.780021166666664,11.177270333333333],
        [49.78002133333333,11.177270333333333],
        [49.78002166666667,11.177270666666667],
        [49.7800225,11.177271166666667],
        [49.780024,11.177271666666666],
        [49.78002466666667,11.177271833333334],
        [49.7800255,11.177272166666667],
        [49.7800255,11.177272333333333],
        [49.780026,11.17728],
        [49.7800255,11.177279333333333],
        [49.780025,11.177278666666666],
        [49.78002433333333,11.1772785],
        [49.7800245,11.177278166666667],
        [49.7800245,11.177278166666667],
        [49.78002633333333,11.177278],
        [49.78002766666667,11.177278333333334],
        [49.7800285,11.1772785],
        [49.780029166666665,11.177278666666666],
        [49.780029666666664,11.177278833333334],
        [49.78003066666667,11.177279],
        [49.78003133333333,11.177279166666667],
        [49.780027,11.177288833333334],
        [49.7800235,11.177298833333333],
        [49.78002266666667,11.177312],
        [49.780047833333334,11.177343166666667],
        [49.7800705,11.177354166666667],
        [49.78007483333333,11.177344333333334],
        [49.780059,11.177330333333334],
        [49.78003416666667,11.177316],
        [49.78001283333333,11.177305833333333],
        [49.779993,11.177290333333334],
        [49.779985,11.177286166666667],
        [49.779977333333335,11.177285],
        [49.779966,11.177276833333334],
        [49.77995416666667,11.177267833333334],
        [49.779931166666664,11.177265833333333],
        [49.77991333333333,11.177253833333333],
        [49.779908666666664,11.177238666666666],
        [49.779889,11.177232333333333],
        [49.77986833333333,11.177222],
        [49.77984566666667,11.177213166666666],
        [49.779821,11.177208666666667],
        [49.77980016666667,11.177192833333333],
        [49.7797765,11.177176666666666],
        [49.779747666666665,11.177160333333333],
        [49.779725166666665,11.177158833333333],
        [49.779720166666664,11.177146166666667],
        [49.779697,11.177152333333334],
        [49.779676,11.1771575],
        [49.77966166666667,11.1771635],
        [49.7796295,11.177191333333333],
        [49.779624166666665,11.177178833333333],
        [49.779597333333335,11.177194666666667],
        [49.77957166666667,11.177209],
        [49.779559166666665,11.177219333333333],
        [49.779541333333334,11.177242333333334],
        [49.779520833333336,11.1772685],
        [49.7795025,11.177289],
        [49.77948333333333,11.177314333333333],
        [49.7794545,11.177353333333333],
        [49.779455666666664,11.177308833333333],
        [49.779422,11.177348833333333],
        [49.77939083333333,11.177410833333333],
        [49.77939083333333,11.1774625],
        [49.77939666666666,11.177491],
        [49.77937683333333,11.1775555],
        [49.77935083333333,11.177560666666666],
        [49.7793535,11.177555333333334],
        [49.779358333333334,11.177530833333334],
        [49.779368166666664,11.177508333333334],
        [49.77934966666667,11.177569333333333],
        [49.77936066666667,11.177539333333334],
        [49.779378333333334,11.177493833333333],
        [49.77938,11.177497833333334],
        [49.77940233333333,11.177457166666667],
        [49.7794355,11.177391166666666],
        [49.77948583333333,11.177323333333334],
        [49.779501,11.177301833333333],
        [49.77951866666667,11.177255166666667],
        [49.779524333333335,11.177238166666667],
        [49.77952533333333,11.177209333333334],
        [49.77951566666667,11.177186666666667],
        [49.77950466666667,11.177154666666667],
        [49.7794725,11.177113833333333],
        [49.779438999999996,11.1770925],
        [49.77943916666667,11.1770925],
        [49.779445833333334,11.177088166666667],
        [49.779440666666666,11.177099833333333],
        [49.779442,11.177096166666667],
        [49.77944766666667,11.1771035],
        [49.77944983333333,11.1771065],
        [49.779453333333336,11.1771035],
        [49.779463666666665,11.1770975],
        [49.779465333333334,11.177097166666666],
        [49.7794755,11.177093],
        [49.77948166666667,11.177090333333334],
        [49.779459333333335,11.1770965],
        [49.77945916666667,11.177094166666667],
        [49.779463166666666,11.177085166666666],
        [49.77946583333333,11.177080833333333],
        [49.77947733333333,11.177074],
        [49.77948116666666,11.177072333333333],
        [49.77948466666667,11.177064666666666],
        [49.77949316666667,11.177053166666667],
        [49.779506,11.177033666666667],
        [49.7795205,11.177011833333333],
        [49.77951566666667,11.177008333333333],
        [49.77951233333334,11.177008666666667],
        [49.779506166666664,11.177016666666667],
        [49.77950166666667,11.1770265],
        [49.77949733333333,11.177036],
        [49.7794965,11.177058166666667],
        [49.77950083333333,11.177079833333334],
        [49.77950083333333,11.177105833333334],
        [49.779498,11.177136],
        [49.7794905,11.1771745],
        [49.77947666666667,11.177221166666667],
        [49.77946033333333,11.177270666666667],
        [49.779438666666664,11.177322],
        [49.77940683333333,11.177374666666667],
        [49.779378,11.177433333333333],
        [49.77934616666667,11.177495],
        [49.7793,11.177561333333333],
        [49.77915766666667,11.1776305]]

        let mewIcon = L.icon({
            iconUrl: '{{ url_for("static", filename="img/mew.png") }}',
            iconSize: [50, 50],
            iconAnchor: [25, 25],
            popupAnchor: [20, 20]
        });

        /*var polyline = L.polyline(points, {color: '#d423bd', smoothFactor: 2.0}).addTo(mymap);

        let wifiIcon = L.icon({
            iconUrl: '{{ url_for("static", filename="img/marker.png") }}',
            iconSize: [50, 43],
            iconAnchor: [25, 30],
            popupAnchor: [0, 0]
        });
        
        for (let i = 0; i < points.length; i++) {
            if(i % 13 == 0) {
                let marker = L.marker(points[i], {opacity: 0.8, icon: wifiIcon}).addTo(mymap)
                let m2 = L.circleMarker(points[i], {color: '#d423bd', stroke: false, radius: 20}).addTo(mymap)
                marker.bindPopup("<b>Mockup AP</b><br>FritzBox 34324").openPopup();
            }
        }
        let currentPos = L.marker(points[points.length-1], {opacity: 0.9, icon: mewIcon}).addTo(mymap)
        // zoom the map to the polyline
        mymap.fitBounds(polyline.getBounds());*/

        let currentPos = L.marker([lat, lon], {opacity: 0.9, icon: mewIcon}).addTo(mymap)
    
        // points.forEach(function(point) {
        //     let marker = L.marker(point).addTo(mymap)
        //     marker.bindPopup("<b>Mockup AP</b><br>FritzBox 34324").openPopup();
        // }); 
    
</script>
{% endblock content %}

  